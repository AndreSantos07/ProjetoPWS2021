<?php
use ArmoredCore\Controllers\BaseController;
use ArmoredCore\WebObjects\Redirect;
use ArmoredCore\WebObjects\Session;
use ArmoredCore\WebObjects\View;
use Carbon\Carbon;
use ArmoredCore\WebObjects\Debug;
use ArmoredCore\Interfaces\ResourceControllerInterface;
use ArmoredCore\WebObjects\Post;




/**
 * Created by PhpStorm.
 * User: smendes
 * Date: 09-05-2016
 * Time: 11:30
 */
class PassageiroController extends BaseController
{

    public function passageiro(){
        return View::make('passageiro.PassageiroIndex');
    }

    public function Registo(){
        return View::make('passageiro.PassageiroRegisto');
    }

    public function GuardarRegisto(){
        $utilizador = new User(Post::getAll());

        $utilizador->save();

        $Lastuser = User::last();
        $passageiro = new Passenger();
        $passageiro->user_id = $Lastuser->user_id;
        $passageiro->checkin = 'Nao';

        $passageiro->save();

        Redirect::toRoute('home/login');
    }

        public function AlterarRegisto(){
            $utilizador = User::find($_SESSION['user_id']);

            if (is_null($utilizador)) {
                //TODO redirect to standard error page
            } else {
                return View::make('passageiro.PassageiroAlterarRegisto', ['utilizador' => $utilizador]);
            }
        }

    public function GuardarAlterarRegisto($idutilizador){
        $utilizador = User::find([$idutilizador]);
        $utilizador->update_attributes(Post::getAll());

        $utilizador->save();
        Redirect::toRoute('passageiro/PassageiroIndex');
    }
    
    public function logout(){

        session_destroy();
        return View::make('home.index');
    }

    public function comprar($flight){

        return View::make('passagem.index',['flight_id'=>$flight]);
    }

    public function validarcompra(){

        $ticket= new Ticket_sale();
        $ticket->purchasedate=Post::get("purchasedate");
        $ticket->type=Post::get("type");
        $ticket->save();

        $passagem = Ticket_sale::last();

        $flight_ticket = new Flights_ticket_sale();
        $flight_ticket->ticket_id = $passagem->ticket_id;
        $flight_ticket->flight_id = Post::get("flight");
        $flight_ticket->type = Post::get("type");
        $flight_ticket->save();

        Redirect::toRoute("voos/index");
    }


}
